#!/bin/sh


# 󰢿 󰢼 󰢽 󰢾           |-> connected to ETH
# 󱈸󰢿 󱈸󰢼 󱈸󰢽 󱈸󰢾 󱈸󰀂    |-> dormant/alert ETH
# 󰤯 󰤟 󰤢 󰤥 󰤨         |-> connected to WIFI
# 󱈸󰤯 󱈸󰤟 󱈸󰤢 󱈸󰤥 󱈸󰤨 󱈸 |-> dormant/alert WIFI
# 󰞃 /              |-> down / unknown


# 󱈸           
#  󰞃 󰢿 󰢼 󰢽 󰢾 󰀂  #SIGNAL/ETH
# 󰤯 󰤟 󰤢 󰤥 󰤨 󰤮 󰤭  #WIFI
# 󰤫 󰤠 󰤣 󰤦 󰤩       #ALERT
# 󰤬 󰤡 󰤤 󰤧 󰤪       #LOCKED
# 󱛏 󱛋 󱛌 󱛍 󱛎       #UNLOCKED



#[[ -s "/tmp/recent_conn" ]] && cat /dev/null > /tmp/recent_conn # flush its content

wlpstat="$(cat /sys/class/net/[Ww]*/operstate)"
#wlpflags="$(cat /sys/class/net/[Ww]*/flags)"
#wifistat="$(nmcli radio wifi)"

enpstat="$(cat /sys/class/net/[Ee]*/operstate)"
#enpflags="$(cat /sys/class/net/[Ee]*/flags)"

if [[ "$enpstat" == "up" ]]; then
	ssid="$(nmcli -f active,ssid device wifi | grep -i '^yes' | cut -c 4- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
	#signal="$(($(nmcli -f active,signal device wifi | grep -i '^yes' | cut -c 4- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')))"
	signal="$(($(nmcli -f active,signal device wifi | grep -i '^yes' | cut -c 4- | tr -d '[:space:]')))"
	#bssid="$(nmcli -f active,bssid device wifi | grep -i '^yes' | cut -c 4- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
	bssid="$(nmcli -f active,bssid device wifi | grep -i '^yes' | cut -c 4- | tr -d '[:space:]')"
	[[ -s "/tmp/recent_conn" ]] || echo "$bssid" > /tmp/recent_conn
	case "$signal" in
		0) printf "󰢿 $ssid";;
		[1-9]) printf "󰢼 $ssid";;
		[1][0-9]) printf "󰢼 $ssid";;
		[2][0-9]) printf "󰢼 $ssid";;
		[3][0-9]) printf "󰢽 $ssid";;
		[4][0-9]) printf "󰢽 $ssid";;
		[5][0-9]) printf "󰢽 $ssid";;
		[6][0-9]) printf "󰢽 $ssid";;
		[7][0-9]) printf "󰢽 $ssid";;
		[8][0-9]) printf "󰢾 $ssid";;
		[9][0-9]) printf "󰢾 $ssid";;
		100) printf "󰢾 $ssid";;
	esac
elif [[ "$wlpstat" == "up" ]]; then
	# 󰤯 󰤟 󰤢 󰤥 󰤨
	ssid="$(nmcli -f active,ssid device wifi | grep -i '^yes' | cut -c 4- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
	signal="$(($(nmcli -f active,signal device wifi | grep -i '^yes' | cut -c 4- | tr -d '[:space:]')))"
	bssid="$(nmcli -f active,bssid device wifi | grep -i '^yes' | cut -c 4- | tr -d '[:space:]')"
	[[ -s "/tmp/recent_conn" ]] || echo "$bssid" > /tmp/recent_conn
	case "$signal" in
		0) printf "󰤯 $ssid";;
		[1-9]) printf "󰤟 $ssid";;
		[1][0-9]) printf "󰤟 $ssid";;
		[2][0-9]) printf "󰤢 $ssid";;
		[3][0-9]) printf "󰤢 $ssid";;
		[4][0-9]) printf "󰤢 $ssid";;
		[5][0-9]) printf "󰤥 $ssid";;
		[6][0-9]) printf "󰤥 $ssid";;
		[7][0-9]) printf "󰤥 $ssid";;
		[8][0-9]) printf "󰤨 $ssid";;
		[9][0-9]) printf "󰤨 $ssid";;
		100) printf "󰤨 $ssid";;
	esac
elif [[ "$enpstat" == "dormant" ]]; then
	[[ -s "/tmp/recent_conn" ]] || printf "󱈸󰀂"
	signal="$(($(nmcli -f bssid,signal device wifi | grep -i "$(tac /tmp/recent_conn)" | head -n 1 | cut -c 18- | tr -d '[:space:]')))"
	ssid="$(nmcli -f bssid,ssid device wifi | grep -i "$(tac /tmp/recent_conn)" | head -n 1 | cut -c 18- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
	case "$signal" in
		0) printf "󱈸󰢿 $ssid";;
		[1-9]) printf "󱈸󰢼 $ssid";;
		[1][0-9]) printf "󱈸󰢼 $ssid";;
		[2][0-9]) printf "󱈸󰢼 $ssid";;
		[3][0-9]) printf "󱈸󰢽 $ssid";;
		[4][0-9]) printf "󱈸󰢽 $ssid";;
		[5][0-9]) printf "󱈸󰢽 $ssid";;
		[6][0-9]) printf "󱈸󰢽 $ssid";;
		[7][0-9]) printf "󱈸󰢽 $ssid";;
		[8][0-9]) printf "󱈸󰢾 $ssid";;
		[9][0-9]) printf "󱈸󰢾 $ssid";;
		100) printf "󱈸󰢾 $ssid";;
	esac

elif [[ "$wlpstat" == "dormant" ]]; then
	[[ -s "/tmp/recent_conn" ]] || printf "󱈸"
	signal="$(($(nmcli -f bssid,signal device wifi | grep -i "$(tac /tmp/recent_conn)" | head -n 1 | cut -c 18- | tr -d '[:space:]')))"
	ssid="$(nmcli -f bssid,ssid device wifi | grep -i "$(tac /tmp/recent_conn)" | head -n 1 | cut -c 18- | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
	case "$signal" in
		0) printf "󱈸󰤯 $ssid";;
		[1-9]) printf "󱈸󰤟 $ssid";;
		[1][0-9]) printf "󱈸󰤟 $ssid";;
		[2][0-9]) printf "󱈸󰤢 $ssid";;
		[3][0-9]) printf "󱈸󰤢 $ssid";;
		[4][0-9]) printf "󱈸󰤢 $ssid";;
		[5][0-9]) printf "󱈸󰤥 $ssid";;
		[6][0-9]) printf "󱈸󰤥 $ssid";;
		[7][0-9]) printf "󱈸󰤥 $ssid";;
		[8][0-9]) printf "󱈸󰤨 $ssid";;
		[9][0-9]) printf "󱈸󰤨 $ssid";;
		100) printf "󱈸󰤨 $ssid";;
	esac
<<COMMENT
	case "$signal" in
		0) printf "󰤫";;
		[1-9]) printf "󰤠";;
		[1][0-9]) printf "󰤠";;
		[2][0-9]) printf "󰤣";;
		[3][0-9]) printf "󰤣";;
		[4][0-9]) printf "󰤣";;
		[5][0-9]) printf "󰤦";;
		[6][0-9]) printf "󰤦";;
		[7][0-9]) printf "󰤦";;
		[8][0-9]) printf "󰤩";;
		[9][0-9]) printf "󰤩";;
		100) printf "󰤩";;
	esac
COMMENT

else
	printf " "
fi
